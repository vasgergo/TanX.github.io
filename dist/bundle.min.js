(()=>{"use strict";class t{constructor(t,e,i,s,a,h,n){switch(this.x=t,this.y=e,this.type=s,this.team=i,this.direction=a,this.context=n,this.img=h,this.width=void 0,this.height=void 0,this.health=void 0,this.fuel=void 0,this.consumption=void 0,this.damage=void 0,this.type){case"light":this.width=30,this.height=30,this.health=10,this.fuel=50,this.consumption=20,this.damage=10;break;case"medium":this.width=45,this.height=45,this.health=10,this.fuel=100,this.consumption=30,this.damage=30;break;case"heavy":this.width=60,this.height=60,this.health=10,this.fuel=150,this.consumption=40,this.damage=50}switch(this.aimParams={p1:70,p2:25},this.speed=0,this.type){case"light":this.speed=3;break;case"medium":this.speed=2;break;case"heavy":this.speed=1}switch(this.roationSpeed=0,this.type){case"light":this.roationSpeed=5;break;case"medium":this.roationSpeed=2;break;case"heavy":this.roationSpeed=1}switch(this.angle=0,this.direction){case"up":this.angle=0;break;case"right":this.angle=90;break;case"down":this.angle=180;break;case"left":this.angle=270}this.aimFunction,this.isCrashed=!1}rotationAnimation(t,e,i){if(this.angle=this.angle%360,this.angle===t)return void i();let s=(t-this.angle+360)%360>180?-1:1,a=setInterval((()=>{this.angle+=s*this.roationSpeed,this.angle=this.angle%360,this.angle<0&&(this.angle+=360),e(),console.log("destinationAngle: ",t),console.log("angle: ",this.angle),this.angle===t&&(console.log("clear"),clearInterval(a),i())}),20)}move(e,i,s,a,h,n){let r=0,o=0;if(this.fuel<=0)return void console.log("No fuel");switch(e){case"up":o=-1*this.speed;break;case"down":o=this.speed;break;case"left":r=-1*this.speed;break;case"right":r=this.speed}let l=new t(this.x+r,this.y+o,this.team,this.type,this.direction,this.img,this.context);if(l.x<0||l.x>n.width-l.width||l.y<0||l.y>n.height-l.height)console.log("Canvas");else{for(let t=0;t<a.length;t++)if(a[t].isOverlap(l)){this.health+=a[t].amount,a.splice(t,1);break}for(let t=0;t<h.length;t++)if(h[t].isOverlap(l)){this.fuel+=h[t].amount,h.splice(t,1);break}for(let t=0;t<i.length;t++)if(i[t].isOverlap(l))return void console.log("Fence");for(let t=0;t<s.length;t++)if(s[t]!==this&&s[t].isOverlap(l))return void console.log("overlapping with: ",s[t].team+" "+s[t].type);this.x+=r,this.y+=o,this.fuel-=this.consumption/100}}getDamage(t){this.health-=t,this.health<=0&&(this.health=0,document.getElementById(this.team+"_"+this.type).style.backgroundColor="red",this.isCrashed=!0)}isOverlap(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}draw(){let t=this.angle;this.context.save(),this.context.translate(this.x+this.img.width/2,this.y+this.img.height/2),this.context.rotate(t*Math.PI/180),this.context.drawImage(this.img,-this.img.width/2,-this.img.height/2),this.context.restore()}}class e{constructor(t){this.color=t,this.tanks=[],this.tankIndex=-1}addTank(t){this.tanks.push(t)}nextTank(){for(this.tankIndex++,this.tankIndex>=this.tanks.length&&(this.tankIndex=0);this.tanks[this.tankIndex].isCrashed;)console.log("Ncrashed"),this.tankIndex++,this.tankIndex>=this.tanks.length&&(this.tankIndex=0);return this.tanks[this.tankIndex]}}class i{static getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}}class s{static overlap(t,e){if(Array.isArray(e)){if(Array.isArray(e[0])){for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++)if(t.x<e[i][s].x+e[i][s].width&&t.x+t.width>e[i][s].x&&t.y<e[i][s].y+e[i][s].height&&t.y+t.height>e[i][s].y)return{isOverlap:!0,overlapWith:e[i][s]};return!1}for(let i=0;i<e.length;i++)if(t.x<e[i].x+e[i].width&&t.x+t.width>e[i].x&&t.y<e[i].y+e[i].height&&t.y+t.height>e[i].y)return{isOverlap:!0,overlapWith:e[i]};return!1}return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}}class a{static image;constructor(t,e,i,s){this.x=t,this.y=e,this.blockSzie=s,this.type=i,this.array=[],this.heightNum=void 0,this.widthNum=void 0,this.height=void 0,this.width=void 0,this.initWall(i)}initWall(t){let e=function(t){let e=[];switch(t){case"normal_x":e=[[1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,1,0,1,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1]];break;case"normal_y":e=[[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]];break;case"normal_round":e=[[0,0,0,0,1,0,0,0,0],[0,0,0,1,1,1,0,0,0],[0,0,1,1,1,1,1,0,0],[0,1,1,1,0,1,1,1,0],[1,1,1,0,0,0,1,1,1],[0,1,1,1,0,1,1,1,0],[0,0,1,1,1,1,1,0,0],[0,0,0,1,1,1,0,0,0],[0,0,0,0,1,0,0,0,0]];break;case"tank_trap":e=[[0,0,0,0,0,1,1,0,0,0,0,0],[0,1,1,0,0,1,1,0,0,1,1,0],[0,1,1,1,0,1,1,0,1,1,1,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,1,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0],[0,0,0,0,1,1,1,1,0,0,0,0],[0,0,0,1,1,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,0,0],[0,1,1,1,0,1,1,0,1,1,1,0],[0,1,1,0,0,1,1,0,0,1,1,0],[0,0,0,0,0,1,1,0,0,0,0,0]];break;default:console.log("No such type")}return e}(t);this.heightNum=e.length,this.widthNum=e[0].length,this.height=e.length*this.blockSzie,this.width=e[0].length*this.blockSzie;for(let t=0;t<this.heightNum;t++)for(let i=0;i<this.widthNum;i++)1===e[t][i]&&this.array.push({x:this.x+i*this.blockSzie,y:this.y+t*this.blockSzie,exist:e[t][i]})}static randomWalls(t,e){let h=[],n={normal_x:2,normal_y:3,normal_round:1,tank_trap:1};for(let r in n){let o=10;for(;n[r]>0&&!(o<0);){let l=i.getRandomInt(50,1e3),d=i.getRandomInt(50,450),c=new a(l,d,r,10,t);s.overlap(c,h).isOverlap||s.overlap(c,e).isOverlap||(h.push(c),n[r]--),o--}}return console.log(h),h}draw(t){for(const e in this.array)this.array[e].exist&&t.drawImage(a.image,this.array[e].x,this.array[e].y,this.blockSzie,this.blockSzie)}isCollide(t,e){if(t<this.x||t>this.x+this.width||e<this.y||e>this.y+this.height)return!1;for(let i=0;i<this.array.length;i++)if(this.array[i].exist&&t>this.array[i].x&&t<this.array[i].x+this.blockSzie&&e>this.array[i].y&&e<this.array[i].y+this.blockSzie)return!0}isOverlap(t){for(let e=0;e<this.array.length;e++)if(this.array[e].exist&&t.x<this.array[e].x+this.blockSzie&&t.x+t.img.width>this.array[e].x&&t.y<this.array[e].y+this.blockSzie&&t.y+t.img.height>this.array[e].y)return!0;return!1}demolish(t,e,i=40){let s,a;for(let h=0;h<this.array.length;h++)s=this.array[h].x+this.blockSzie/2,a=this.array[h].y+this.blockSzie/2,Math.sqrt((s-t)**2+(a-e)**2)<i&&(this.array[h].exist=!1)}}class h{static image;static ctx;constructor(t,e){this.x=t,this.y=e,this.width=30,this.height=30,this.amount=20}draw(){h.ctx.drawImage(h.image,this.x,this.y,this.width,this.height)}isOverlap(t){return t.x<this.x+this.width&&t.x+t.img.width>this.x&&t.y<this.y+this.height&&t.y+t.img.height>this.y}static randomHeal(t){let e,a=0,n=0,r=100,o=!0;for(;o&&r>0;){a=i.getRandomInt(50,1e3),n=i.getRandomInt(50,450),e=new h(a,n),o=!1;for(let i=0;i<t.length;i++)if(s.overlap(e,t[i]).isOverlap){o=!0;break}r--}return e}}class n{static image;static ctx;constructor(t,e){this.x=t,this.y=e,this.width=30,this.height=30,this.amount=50}draw(){n.ctx.drawImage(n.image,this.x,this.y,this.width,this.height)}isOverlap(t){return t.x<this.x+this.width&&t.x+t.img.width>this.x&&t.y<this.y+this.height&&t.y+t.img.height>this.y}static randomFuel(t){let e,a=0,h=0,r=100,o=!0;for(;o&&r>0;){a=i.getRandomInt(50,1e3),h=i.getRandomInt(50,450),e=new n(a,h),o=!1;for(let i=0;i<t.length;i++)if(s.overlap(e,t[i]).isOverlap){o=!0;break}r--}return e}}const r=["desert","red_heavy","red_light","red_medium","blue_heavy","blue_light","blue_medium","fence","red_cross","fuel","heal"];let o=document.getElementById("myCanvas").width,l=document.getElementById("myCanvas").height;window.innerWidth,window.innerHeight;let d,c,g,m,u,y,w=[],k=[],p=!1,f=[],x=[],v=0;const b=30,I=1e3;let _,E=[],T=[],S=[];function A(){let t,e;for(let i=0;i<f.length;i++)t=f[i].team,e=f[i].type,document.getElementById(t+"_"+e+"_health").innerText=f[i].health,document.getElementById(t+"_"+e+"_fuel").innerText=f[i].fuel.toFixed(1),document.getElementById(t+"_"+e+"_consumption").innerText=f[i].consumption,document.getElementById(t+"_"+e+"_damage").innerText=f[i].damage}function P(){v=b,u=u===g?m:g,y=u.nextTank(),console.log("->Active player is: "+u.color+" tank: "+y.type),A(),function(){let t;for(let e=0;e<f.length;e++)t=f[e]===y?"green":f[e].isCrashed?"red":"white",document.getElementById(f[e].team+"_"+f[e].type).style.backgroundColor=t}(),document.getElementById(y.team+"_"+y.type).style.backgroundColor="green","blue"===u.color?(document.getElementById("blueActiveTankImg").src=y.img.src,document.getElementById("redActiveTankImg").src=k.red_cross.src):(document.getElementById("redActiveTankImg").src=y.img.src,document.getElementById("blueActiveTankImg").src=k.red_cross.src),window.addEventListener("keypress",z),window.addEventListener("keydown",C),_=setInterval((()=>{window.document.getElementById("timer").innerText=v.toFixed(1),v<=.1&&(console.log("time is up"),clearInterval(_),B(),setTimeout((()=>{P()}),1e3)),v-=.1}),100),y.aimFunction=N,p=!0,E.push(h.randomHeal(S)),T.push(n.randomFuel(S)),O()}function B(){clearInterval(_),window.removeEventListener("keydown",C),window.removeEventListener("keypress",z)}function C(t){switch(t.key){case"w":y.move("up",x,f,E,T,c);break;case"s":y.move("down",x,f,E,T,c);break;case"a":y.move("left",x,f,E,T,c);break;case"d":y.move("right",x,f,E,T,c);break;case"ArrowUp":y.aimParams.p1+=1;break;case"ArrowDown":y.aimParams.p1-=1;break;case"ArrowLeft":y.aimParams.p2-=1;break;case"ArrowRight":y.aimParams.p2+=1;break;case"Enter":B(),function(t){let e,i,s,a,h;console.log("shoot!");let n,r,c=t.aimFunction,g=t.aimParams.p1,m=t.aimParams.p2;switch(t.angle){case 0:a=t.x+t.img.width/2,h=t.y,e=-1,i=1,s=!0;break;case 90:a=t.x+t.img.width,h=t.y+t.img.height/2,e=1,i=1,s=!1;break;case 180:a=t.x+t.img.width/2,h=t.y+t.img.height,e=1,i=1,s=!0;break;case 270:a=t.x,h=t.y+t.img.height/2,e=-1,i=-1,s=!1}let u,w=0,p=setInterval((()=>{d.drawImage(k.desert,0,0,o,l),f.forEach((t=>{t.draw()})),x.forEach((t=>{t.draw(d)})),T.forEach((t=>{t.draw()})),E.forEach((t=>{t.draw()})),d.beginPath(),d.lineWidth=2,d.moveTo(a,h);for(let t=0;t<w;t++){if(s?(n=a+i*c(t,g,m),r=h+e*t):(n=a+e*t,r=h+i*c(t,g,m)),u=F(n,r),u.bool)return d.lineTo(n,r),d.stroke(),d.closePath(),clearInterval(p),null!==u.tank&&u.tank.getDamage(y.damage),void setTimeout((()=>{P()}),I);for(let t=0;t<x.length;t++)if(x[t].isCollide(n,r))return x[t].demolish(n,r),d.lineTo(n,r),d.stroke(),d.closePath(),clearInterval(p),void setTimeout((()=>{P()}),I);d.lineTo(n,r)}d.stroke(),d.closePath(),w++}),1)}(y)}O()}function z(t){switch("8"!==t.key&&"6"!==t.key&&"2"!==t.key&&"4"!==t.key||(p=!1,window.removeEventListener("keypress",z),window.removeEventListener("keydown",C),console.log("key removed")),t.key){case"8":y.rotationAnimation(0,O,e);break;case"6":y.rotationAnimation(90,O,e);break;case"2":y.rotationAnimation(180,O,e);break;case"4":y.rotationAnimation(270,O,e)}function e(){v!==b&&(p=!0,O(),window.addEventListener("keypress",z),window.addEventListener("keydown",C))}}function O(){d.drawImage(k.desert,0,0,o,l),p&&function(t){let e,i,s,a,h,n=t.aimFunction,r=t.aimParams.p1,o=t.aimParams.p2;switch(y.angle){case 0:a=y.x+y.img.width/2,h=y.y,e=-1,i=1,s=!0;break;case 90:a=y.x+y.img.width,h=y.y+y.img.height/2,e=1,i=1,s=!1;break;case 180:a=y.x+y.img.width/2,h=y.y+y.img.height,e=1,i=1,s=!0;break;case 270:a=y.x,h=y.y+y.img.height/2,e=-1,i=-1,s=!1}d.beginPath(),d.strokeStyle="red",d.lineWidth=2,d.moveTo(a,h);let l,c,g=a,m=h,u=0;for(let t=0;u<500;t++)s?(l=a+i*n(t,r,o),c=h+e*t):(l=a+e*t,c=h+i*n(t,r,o)),u+=Math.sqrt(Math.pow(l-g,2)+Math.pow(c-m,2)),g=l,m=c,d.lineTo(l,c);d.stroke(),d.closePath()}(y),T.forEach((t=>{t.draw()})),E.forEach((t=>{t.draw()})),x.forEach((t=>{t.draw(d)})),f.forEach((t=>{t.draw()})),A()}function F(t,e){if(t<0||t>o||e<0||e>l)return console.log("wall collosion!"),{bool:!0,tank:null};for(let i=0;i<f.length;i++){let s=f[i];if(t>s.x&&t<s.x+s.img.width&&e>s.y&&e<s.y+s.img.height)return console.log("tankcollosion!"),{bool:!0,tank:s}}return!1}function N(t,e,i){return-Math.sin(t/i)*e}function L(){let t=document.getElementById("gameContainer"),e=window.innerWidth,i=window.innerHeight,s=e/2,a=i/2,h=Number((e/1536).toFixed(3)),n=Number((i/703).toFixed(3)),r=Math.min(h,n),o=1536*r,l=703*r;t.style.scale=r.toString(),t.style.top=a-l/2+"px",t.style.left=s-o/2+"px"}window.onload=function(){!function(){function i(t){return new Promise((e=>{let i=new Image;i.src="./Pictures/"+t+".png",i.onload=()=>{k[t]=i,e()}}))}let s=[];for(let t=0;t<r.length;t++)s.push(i(r[t]));Promise.all(s).then((()=>{console.log("all images loaded"),function(){c=document.getElementById("myCanvas"),d=c.getContext("2d"),h.image=k.heal,n.image=k.fuel,a.image=k.fence,h.ctx=d,n.ctx=d,g=new e("red"),m=new e("blue"),w.push(m),w.push(g),m.addTank(new t(100,150,"blue","light","right",k.blue_light,d)),m.addTank(new t(110,300,"blue","medium","right",k.blue_medium,d)),m.addTank(new t(100,450,"blue","heavy","right",k.blue_heavy,d)),g.addTank(new t(930,150,"red","light","left",k.red_light,d)),g.addTank(new t(890,310,"red","medium","left",k.red_medium,d)),g.addTank(new t(950,430,"red","heavy","left",k.red_heavy,d)),w.forEach((t=>{t.tanks.forEach((t=>{f.push(t)}))}));let i=!1;S.push(x,E,T,f),i||(x.push(new a(350,100,"normal_y",10)),x.push(new a(350,400,"normal_y",10)),x.push(new a(700,100,"normal_y",10)),x.push(new a(700,400,"normal_y",10)),x.push(new a(480,250,"tank_trap",10)),E.push(new h(180,150)),E.push(new h(500,450)),E.push(new h(900,45)),T.push(new n(700,270)),T.push(new n(500,150)),console.log(S));i&&(S.push(f),x=a.randomWalls(k.fence,S),S.push(x),E.push(h.randomHeal(S)),T.push(n.randomFuel(S)));u=g,window.addEventListener("keydown",(t=>{t.key})),console.log("game started"),O(),P()}()}))}(),L()},window.onresize=function(){L()}})();